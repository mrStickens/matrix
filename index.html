<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Матрица Судьбы</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <style>
        :root {
            --primary-color: #2b5278;
            --secondary-color: #454b88;
            --background-color: #ffffff;
            --text-color: #333333;
            --grid-cell-size: 60px;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
        }

        .input-section {
            margin: 20px 0;
            text-align: center;
        }

        input[type="date"] {
            padding: 10px;
            margin: 10px;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: var(--secondary-color);
        }

        .result-section {
            margin-top: 30px;
        }

        .matrix-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(3, var(--grid-cell-size));
            grid-template-rows: repeat(3, var(--grid-cell-size));
            gap: 2px;
            background-color: var(--primary-color);
            padding: 2px;
            border-radius: 4px;
        }

        .matrix-cell {
            background-color: var(--background-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }

        .interpretation {
            text-align: left;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 4px;
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Матрица Судьбы</h1>

        <div class="input-section">
            <label for="birthdate">Введите дату рождения:</label>
            <input type="date" id="birthdate" required>
            <button id="calculate">Рассчитать</button>
        </div>

        <div class="result-section hidden">
            <div class="matrix-container">
                <div class="matrix-grid"></div>
            </div>
            <div class="interpretation"></div>
        </div>
    </div>

    <script>
        // Полный JavaScript код для расчётов
        class MatrixCalculator {
            constructor() {
                this.matrix = Array(3).fill().map(() => Array(3).fill(0));
            }

            sumOfDigits(number) {
                return String(number)
                    .split('')
                    .filter(ch => /\d/.test(ch))
                    .reduce((sum, digit) => sum + parseInt(digit), 0);
            }

            reduceToSingleDigit(num) {
                while (num > 9) {
                    num = this.sumOfDigits(num);
                }
                return num;
            }

            calculateMatrix(birthdate) {
                const dateStr = birthdate.split('-').reverse().join('');
                const day = parseInt(dateStr.substring(0, 2));
                const month = parseInt(dateStr.substring(2, 4));
                const year = parseInt(dateStr.substring(4));

                const digitsOfBirthdate = dateStr.split('').map(Number);
                const S1 = digitsOfBirthdate.reduce((sum, digit) => sum + digit, 0);
                const S2 = this.reduceToSingleDigit(S1);
                const D = S1 - 2 * day;
                const S3 = this.reduceToSingleDigit(D);

                const finalDigits = [
                    ...digitsOfBirthdate,
                    ...String(S1).split('').map(Number),
                    S2,
                    ...String(D).split('').map(Number),
                    S3
                ].filter(x => x !== 0);

                const counts = {};
                for (let i = 1; i <= 9; i++) {
                    counts[i] = finalDigits.filter(x => x === i).length;
                }

                this.matrix = [
                    [counts[1] || 0, counts[2] || 0, counts[3] || 0],
                    [counts[4] || 0, counts[5] || 0, counts[6] || 0],
                    [counts[7] || 0, counts[8] || 0, counts[9] || 0]
                ];

                return {
                    matrix: this.matrix,
                    additional: {
                        S1,
                        S2,
                        D,
                        S3,
                        dateStr,
                        day,
                        month,
                        year
                    }
                };
            }

            getInterpretation() {
                let interpretation = [];
                const totalNumbers = this.matrix.flat().reduce((sum, num) => sum + num, 0);
                interpretation.push(`Всего чисел в матрице: ${totalNumbers}`);

                const characterSum = this.matrix[0].reduce((sum, num) => sum + num, 0);
                interpretation.push(`Сила характера: ${characterSum}`);

                const energySum = this.matrix[1].reduce((sum, num) => sum + num, 0);
                interpretation.push(`Энергетический потенциал: ${energySum}`);

                const intuitionSum = this.matrix[2].reduce((sum, num) => sum + num, 0);
                interpretation.push(`Уровень интуиции: ${intuitionSum}`);

                return interpretation;
            }
        }

        class MatrixUI {
            constructor() {
                this.calculator = new MatrixCalculator();
                this.initializeElements();
                this.attachEventListeners();
            }

            initializeElements() {
                this.birthdateInput = document.getElementById('birthdate');
                this.calculateButton = document.getElementById('calculate');
                this.resultSection = document.querySelector('.result-section');
                this.matrixGrid = document.querySelector('.matrix-grid');
                this.interpretation = document.querySelector('.interpretation');
            }

            attachEventListeners() {
                this.calculateButton.addEventListener('click', () => this.handleCalculate());

                this.birthdateInput.addEventListener('change', (e) => {
                    const date = new Date(e.target.value);
                    const now = new Date();
                    if (date > now) {
                        alert('Пожалуйста, выберите корректную дату рождения');
                        e.target.value = '';
                    }
                });
            }

            handleCalculate() {
                const birthdate = this.birthdateInput.value;
                if (!birthdate) {
                    alert('Введите корректную дату');
                    return;
                }

                const result = this.calculator.calculateMatrix(birthdate);
                this.displayMatrix(result.matrix);
                const interpretation = this.displayInterpretation(result);

                this.resultSection.classList.remove('hidden');
            }

            displayMatrix(matrix) {
                this.matrixGrid.innerHTML = '';
                matrix.forEach(row => {
                    row.forEach(value => {
                        const cell = document.createElement('div');
                        cell.className = 'matrix-cell';
                        cell.textContent = value;
                        this.matrixGrid.appendChild(cell);
                    });
                });
            }

            displayInterpretation(result) {
                const interpretations = this.calculator.getInterpretation();
                const interpretationHTML = interpretations.map(text => `<p>${text}</p>`).join('');
                this.interpretation.innerHTML = `
                    <h3>Интерпретация вашей матрицы:</h3>
                    ${interpretationHTML}
                    <p class="disclaimer">* Это базовая интерпретация. Для более глубокого анализа рекомендуется консультация специалиста.</p>
                `;
                return interpretations;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new MatrixUI();
        });
    </script>
</body>
</html>

